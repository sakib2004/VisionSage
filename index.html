<!DOCTYPE html>
<html lang="en">
<head>
  {% extends "base.html" %}
  {% block title %}Home - VisionSage{% endblock %}
</head>
<body>
  {% block content %}
  <section class="hero">
    <div class="hero-content">
      <h1>Discover VisionSage</h1>
      <p>Revolutionize safety with AI-driven image analysis. Detect threats, identify objects, and extract metadata with precision.</p>
      <div class="ai-visuals">
        <img src="{{ url_for('static', filename='ai_image1.jpg') }}" alt="AI Neural Network" class="ai-image">
        <img src="{{ url_for('static', filename='ai_image2.jpg') }}" alt="AI Analysis" class="ai-image">
      </div>
      {% if current_user.is_authenticated %}
        <form action="{{ url_for('upload_image') }}" method="POST" enctype="multipart/form-data" class="image-upload">
          <div class="section">
            <h2>Analyze Your Images</h2>
            <div class="input-group neumorphic">
              <label for="image_1"><i class="fas fa-image"></i> Image 1:</label>
              <input type="file" id="image_1" name="image_1" accept=".jpg,.jpeg,.png">
            </div>
            <div class="input-group neumorphic">
              <label for="image_2"><i class="fas fa-image"></i> Image 2:</label>
              <input type="file" id="image_2" name="image_2" accept=".jpg,.jpeg,.png">
            </div>
            <div class="input-group neumorphic">
              <label for="image_3"><i class="fas fa-image"></i> Image 3:</label>
              <input type="file" id="image_3" name="image_3" accept=".jpg,.jpeg,.png">
            </div>
            <div class="input-group neumorphic">
              <label><i class="fas fa-cogs"></i> Analysis Options:</label>
              <label class="checkbox-label">
                <input type="checkbox" name="description" value="true" checked>
                <i class="fas fa-file-alt"></i> Description
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="harmful" value="true">
                <i class="fas fa-exclamation-triangle"></i> Harmful Objects
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="detected_objects" value="true">
                <i class="fas fa-object-group"></i> Detected Objects
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="metadata" value="true">
                <i class="fas fa-info-circle"></i> Metadata
              </label>
            </div>
            <div class="input-group neumorphic">
              <label for="case_folder"><i class="fas fa-folder"></i> Case Folder:</label>
              <input type="text" id="case_folder" name="case_folder" placeholder="e.g., Case123" value="Default">
            </div>
            <div class="input-group neumorphic">
              <label for="custom_harmful"><i class="fas fa-shield-alt"></i> Custom Harmful Objects (comma-separated):</label>
              <input type="text" id="custom_harmful" name="custom_harmful" placeholder="e.g., knife,gun">
            </div>
            <div class="button-group">
              <button type="submit" class="upload-btn neumorphic">Analyze Now</button>
            </div>
          </div>
        </form>
      {% else %}
        <button class="upload-btn neumorphic" onclick="openModal()">Login to Analyze</button>
      {% endif %}
    </div>
  </section>

  {% if current_user.is_authenticated %}
    <section class="results">
      <div class="about-container">
        <h2>Analysis Results</h2>
        {% if images %}
          <div class="results-table-container">
            <table class="results-table neumorphic">
              <thead>
                <tr>
                  <th><i class="fas fa-image"></i> Image</th>
                  <th><i class="fas fa-file-alt"></i> Description</th>
                  <th><i class="fas fa-exclamation-triangle"></i> Harmful Objects</th>
                  <th><i class="fas fa-object-group"></i> Detected Objects</th>
                  <th><i class="fas fa-info-circle"></i> Metadata</th>
                  <th><i class="fas fa-folder"></i> Case ID</th>
                  <th><i class="fas fa-clock"></i> Timestamp</th>
                  <th><i class="fas fa-history"></i> Timeline</th>
                </tr>
              </thead>
              <tbody>
                {% for image in images %}
                  <tr class="result-row">
                    <td>
                      <img src="{{ url_for('uploaded_file', filename=image.file_path | basename) }}" alt="Uploaded Image" class="result-image">
                      <span>{{ image.file_path | basename }}</span>
                    </td>
                    <td>{{ image.description | default('N/A') }}</td>
                    <td>{{ image.harmful_objects | default('N/A') }}</td>
                    <td class="truncate">{{ image.detected_objects | default('N/A') }}</td>
                    <td>
                      {% if image.metadata %}
                        <pre>{{ image.metadata | tojson | safe }}</pre>
                      {% else %}
                        N/A
                      {% endif %}
                    </td>
                    <td>{{ image.case_id | default('N/A') }}</td>
                    <td>{{ image.timestamp }}</td>
                    <td>
                      {% if image.case_id %}
                        <a href="{{ url_for('case_timeline', case_id=image.case_id) }}" class="btn btn-sm btn-info">View Timeline</a>
                      {% else %}
                        N/A
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="mt-3">
              <a href="{{ url_for('print_user_data') }}" class="upload-btn neumorphic">Download Report (PDF)</a>
              <a href="{{ url_for('dashboard') }}" class="btn btn-info">Dashboard</a>
              <a href="{{ url_for('search') }}" class="btn btn-info">Search Images</a>
            </div>
          </div>
        {% else %}
          <p>No images analyzed yet.</p>
        {% endif %}
      </div>
    </section>
  {% endif %}

  <section class="features">
    <div class="about-container">
      <h2 class="section-title">Why VisionSage?</h2>
      <div class="feature-grid">
        <div class="feature-card neumorphic">
          <i class="fas fa-robot icon-ai"></i>
          <h3>Advanced AI</h3>
          <p>Harness cutting-edge AI for precise image analysis.</p>
        </div>
        <div class="feature-card neumorphic">
          <i class="fas fa-shield-alt icon-security"></i>
          <h3>Secure Platform</h3>
          <p>Protect your data with robust encryption.</p>
        </div>
        <div class="feature-card neumorphic">
          <i class="fas fa-hand-holding-heart icon-ease"></i>
          <h3>Seamless Experience</h3>
          <p>Intuitive interface for effortless navigation.</p>
        </div>
      </div>
    </div>
  </section>
  {% endblock %}
</body>
</html>